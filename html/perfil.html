<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda Barbería - Perfil</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="main.js" defer></script>
</head>

<body class="bg-gray-100">
    <header>
        <nav class="bg-blue-800">
            <div class="mx-auto max-w-7xl px-2 sm:px-6 lg:px-8">
                <div class="relative flex h-16 items-center justify-between">
                    <div class="flex flex-1 items-center justify-center sm:items-stretch sm:justify-start">
                        <div class="flex flex-shrink-0 items-center">
                            <img class="h-8 w-auto" src="/img/logo2.png" alt="Tienda Barbería">
                        </div>
                        <div class="hidden sm:ml-6 sm:block">
                            <div class="flex space-x-4">
                                <a href="index.html"
                                    class="rounded-md px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white">Inicio</a>
                                <a href="productos.html"
                                    class="rounded-md px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white">Productos</a>
                                <a href="nosotros.html"
                                    class="rounded-md px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white">Nosotros</a>
                                <a href="contacto.html"
                                    class="rounded-md px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white">Contacto</a>
                                <a href="blog.html"
                                    class="rounded-md px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white">Blog</a>
                                <a href="login.html" id="loginLink"
                                    class="rounded-md px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white">Login</a>
                                <a href="perfil.html" id="perfilLink"
                                    class="rounded-md bg-gray-900 px-3 py-2 text-sm font-medium text-white hidden"
                                    aria-current="page">Perfil</a>
                                <a href="carrito.html"
                                    class="rounded-md px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white">Carrito</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-6 mt-8 bg-white rounded-lg shadow-md">
        <h2 class="text-4xl font-extrabold text-center mb-4 text-blue-700">Perfil del Usuario</h2>

        <div id="user-info" class="flex items-center space-x-4 text-gray-700 text-lg">
            <div class="flex-shrink-0">
                <img id="user-photo" class="w-32 h-32 rounded-full border-2 border-blue-500" src="default-photo.png"
                    alt="Foto de Usuario">
            </div>
            <div class="flex justify-between items-center w-full">
                <div>
                    <p><strong>Nombre:</strong> <span id="user-name">Cargando...</span></p>
                    <p><strong>Apellido:</strong> <span id="user-lastname">Cargando...</span></p>
                    <p><strong>Correo:</strong> <span id="user-email">Cargando...</span></p>
                    <p><strong>Cédula:</strong> <span id="user-id">Cargando...</span></p>
                    <p><strong>Rol:</strong> <span id="user-role">Cargando...</span></p>
                </div>
                <button id="logoutButton" class="ml-4 bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600">
                    Cerrar Sesión
                </button>
            </div>


        </div>

        <h2 class="text-3xl font-bold mt-8 text-blue-700">Lista de Productos</h2>
        <table class="min-w-full mt-4 bg-white border border-gray-300">
            <thead>
                <tr>
                    <th class="py-2 px-4 border-b font-bold text-left text-gray-700">ID</th>
                    <th class="py-2 px-4 border-b font-bold text-left text-gray-700">Nombre</th>
                    <th class="py-2 px-4 border-b font-bold text-left text-gray-700">Descripción</th>
                    <th class="py-2 px-4 border-b font-bold text-left text-gray-700">Precio</th>
                    <th class="py-2 px-4 border-b font-bold text-left text-gray-700">Stock</th>
                    <th class="py-2 px-4 border-b font-bold text-left text-gray-700">Estado</th>
                    <th class="py-2 px-4 border-b font-bold text-left text-gray-700">Acciones</th>
                </tr>
            </thead>
            <tbody id="product-table-body">
                <tr>
                    <td colspan="7" class="text-center py-4">Cargando productos...</td>
                </tr>
            </tbody>
        </table>
    </main>

    <footer class="bg-blue-600 text-white p-4 text-center mt-8">
        <p>&copy; 2024 Tienda Barbería. Todos los derechos reservados.</p>
        <p>Encuéntranos en nuestras redes sociales:</p>
        <div class="flex justify-center space-x-4 mt-2">
            <a href="#" class="hover:text-blue-300">Facebook</a>
            <a href="#" class="hover:text-blue-300">Instagram</a>
            <a href="#" class="hover:text-blue-300">Twitter</a>
        </div>
    </footer>

    <script>
        function loadUserData() {
            const userData = JSON.parse(localStorage.getItem('usuario'));
            if (userData) {
                document.getElementById('user-name').innerText = userData.user_nombre || 'No disponible';
                document.getElementById('user-lastname').innerText = userData.user_apellido || 'No disponible';
                document.getElementById('user-email').innerText = userData.user_correo || 'No disponible';
                document.getElementById('user-id').innerText = userData.user_cedula || 'No disponible';
                document.getElementById('user-role').innerText = userData.user_rol || 'No disponible';
                document.getElementById('user-photo').src = userData['user_foto-url'] || 'default-photo.png';
            } else {
                document.getElementById('user-info').innerHTML = '<p class="text-red-500">No se encontraron datos de usuario.</p>';
            }
        }

        async function loadProducts() {
            try {
                const response = await fetch('http://localhost:3000/productos');
                const products = await response.json();
                const productTableBody = document.getElementById('product-table-body');

                productTableBody.innerHTML = '';

                products.forEach(product => {
                    const row = document.createElement('tr');
                    const precioFormateado = parseFloat(product.pro_precio).toFixed(2);
                    row.innerHTML = `
            <td class="py-2 px-4 border-b">${product.pro_id}</td>
            <td class="py-2 px-4 border-b">${product.pro_nombre}</td>
            <td class="py-2 px-4 border-b">${product.pro_descripcion}</td>
            <td class="py-2 px-4 border-b">${precioFormateado} USD</td>
            <td class="py-2 px-4 border-b">${product.pro_stock}</td>
            <td class="py-2 px-4 border-b">${product.pro_estado}</td>
            <td class="py-2 px-4 border-b">
              <button onclick="addStock(${product.pro_id})" class="bg-green-500 text-white py-1 px-3 rounded hover:bg-green-600">Agregar Stock</button>
            </td>
          `;
                    productTableBody.appendChild(row);
                });

                if (products.length === 0) {
                    productTableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4">No hay productos disponibles.</td></tr>';
                }
            } catch (error) {
                console.error('Error al cargar productos:', error);
                const productTableBody = document.getElementById('product-table-body');
                productTableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-red-500">Error al cargar productos.</td></tr>';
            }
        }

        async function addStock(productId) {
            const cantidad = prompt("Ingrese la cantidad de stock a agregar:");

            if (!cantidad || isNaN(cantidad) || cantidad <= 0) {
                alert('Cantidad inválida.');
                return;
            }

            try {
                const response = await fetch(`http://localhost:3000/agregar-stock/${productId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ cantidad })
                });

                if (response.ok) {
                    const data = await response.json();
                    alert(data.message || 'Stock agregado exitosamente.');
                    loadProducts();
                } else {
                    const errorData = await response.json();
                    alert(errorData.message || 'Error al agregar stock.');
                }
            } catch (error) {
                console.error('Error al agregar stock:', error);
            }
        }


        function logout() {
            const confirmation = confirm("¿Está seguro que desea cerrar sesión? No podrás volver a acceder a tu sesión actual.");
            if (confirmation) {
                localStorage.removeItem('usuario');
                window.location.href = 'index.html';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadUserData();
            loadProducts();

            document.getElementById('logoutButton').addEventListener('click', logout);
        });

    </script>

    <script>
        function toggleLoginPerfil() {
            const loginLink = document.getElementById('loginLink');
            const perfilLink = document.getElementById('perfilLink');

            if (localStorage.getItem('usuario')) {
                perfilLink.classList.remove('hidden');
                loginLink.classList.add('hidden');
            } else {
                perfilLink.classList.add('hidden');
                loginLink.classList.remove('hidden');
            }
        }
        window.onload = toggleLoginPerfil;
    </script>
</body>

</html>